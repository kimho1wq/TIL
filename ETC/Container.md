# Container

### Container 란
- 소프트웨어 서비스를 실행하는 데 필요한 특정 버전의 프로그래밍 언어 런타임 및 라이브러리와 같은 종속 항목과 어플리케이션 코드를 함께 포함하는 경량 패키지
- 어플리케이션에 필요한 구성을 패키지로 묶어, 운영 환경이 달라져도 동일하게 실행될 수 있도록 도와주는 역할
- 컨테이너는 애플리케이션을 실제 구동 환경으로부터 추상화할 수 있는 논리 패키징 메커니즘을 제공한다
- Container와 VM(Virtual Machine)
  - VM은 호스트 운영체제 위에서 Linux 또는 Windows 같은 게스트 운영 체제를 실행하는 가상 기계
  - 컨테이너와 VM 모두 애플리케이션을 관련 라이브러리 및 종속 항목과 함께 패키지로 묶어, 소프트웨어 서비스 구동을 위한 격리 환경을 마련해 준다
  - 다만, 컨테이너는 OS 수준에서 가상화되고 VM은 하드웨어 수준에서 가상화되며, 컨테이너가 VM보다 훨씬 더 경량이다
  - 또한 컨테이너는 OS 커널을 공유하며 VM에 필요한 것보다 훨씬 적은 메모리를 사용한다


### Docker
- 리눅스의 응용 프로그램들을 프로세스 격리 기술들을 사용해 컨테이너로 실행하고 관리하는 오픈 소스 프로젝트
  - ![image](https://github.com/kimho1wq/TIL/assets/15611500/b87154bc-0626-4b2a-9434-b7df89392feb)
  - VM은 가상화를 시키기 위한 Hypervisor 엔진 그리고 그 위에 Guest OS를 올려 사용하기 때문에, Host OS와 완전히 분리되며 무겁고 느리다
  - Docker는 Host OS의 커널을 공유하며 I/O처리가 쉽게 되어 성능의 효율을 높일 수 있고, Host OS가 사용하는 자원을 분리하여 여러 환경을 만드는 것이다
  - 즉, Docker를 사용하는 이유는 뛰어난 성능 향상, 이식성, 쉽게 Scale Out을 할 수 있는 유연성 등이 있다
- Docker Image
  - 컨테이너를 실행할 수 있는 실행 파일, 설정 값 등을 가지고 있는 것으로, Image를 컨테이너에 담고 실행시킨다
  - ![image](https://github.com/kimho1wq/TIL/assets/15611500/3c45e4dc-ef79-4801-9326-81acfdc7e639)
- Docker File
  - 이미지 생성 출발점으로 이미지를 구성하기 위한 명령어들을 작성하여 이미지를 구성 해주는 파일

### Jib    
- 도커 설치, 도커 파일을 작성하지 않고, 자바 애플리케이션을 간편하게 컨테이너화할 수 있도록 돕는 오픈 소스 기반 도구
- Maven이나 Gradle에서 빌드하면 컨테이너 환경에 최적화된 자바 애플리케이션을 생성한다


### Kubernetes(k8s, kube)
- 컨테이너화된 애플리케이션을 배포나 관리할 때 수반되는 프로세스를 관리해주는 오픈 소스 컨테이너 오케스트레이션(Orchestration) 플랫폼
- 쿠버네티스는 자동으로 네트워크 트래픽을 로드밸런싱하며 배포가 안정적으로 이루어질 수 있도록 하고, 장애 시 애플리케이션의 롤백도 제공한다
- 쿠버네티스에서는 명령형 인터페이스가 아닌 선언형 인터페이스를 사용한다
  - 어떤 동작을 지시하는 것이 아니라 원하는 상태를 선언하는 것으로, 현재 상태와 선언된 상태(desired state)가 일치하는지를 지속적으로 체크한다
  - 클러스터의 상태를 나타내기 위한 단위로 Objects 사용한다
    - 어떤 컨테이너화된 애플리케이션이 동작 중인지, 어떤 상태인지, 그 애플리케이션이 이용할 수 있는 리소스, 어떤 의도로 작성되었는지 등
    - Objects에 대한 명세(Spec)은 주로 YAML로 정의한다(생성, 조회, 삭제 등)
    - 주요 Objects로는 Pod, ReplicaSet, Deployments, Service, Volume 등이 있다
      - Pod: 쿠버네티스에서 배포할 수 있는 가장 작은 단위
        - 한 개 이상의 컨테이너와 스토리지, 네트워크 속성을 가진다
        - Pod에 속한 컨테이너는 스토리지와 네트워크를 공유하고, 서로 localhost로 접근할 수 있다
      - ReplicaSet: Pod를 한 개 이상 복제하여 관리하는 오브젝트
        - ReplicaSet은 복제할 개수, 개수를 체크할 라벨 선택자, 생성할 Pod의 설정 값 등을 가지고 있다
        - 이를 직접적으로 사용하기보다는 Deployments 등 다른 오브젝트에 의해 사용되는 경우가 많다
      - Service: 네트워크와 관련된 오브젝트
        - Pod를 외부 네트워크와 연결해주고, 여러 개의 Pod를 바라보는 내부 로드밸런서를 생성할 떄 사용한다
        - 내부 DNS에 서비스 이름을 도메인으로 등록하기 떄문에 서비스 디스커버리 역할도 한다
      - Volume: 저장소와 관련된 오브젝트
        - 호스트 디렉토리를 그대로 이용하거나 클라우드 스토리지를 동적으로 생성하여 사용할 수 있다
  - Controller는 클러스터의 실제 상태와 원하는 상태를 관찰하는 무한 루프이다
- 쿠버네티스 기반 개발
  - 소스 코드를 수정한 후, 수정한 코드를 컴파일
  - 컴파일한 소스 코드를 포함해서 Dockerfile을 이용해서 컨테이너로 패키징
  - 컨테이너를 레파지토리 새로운 버전 태그를 붙여서 업로드
  - 쿠버네티스의 기존 Deployment나 Pod의 yaml 파일에 image 명을 바꾼후
  - kubectl -f apply 를 이용해서 변경된 파일을 반영
  - 다음 public IP가 있는 서비스의 경우에는 public IP로 접속하고, 아닌 경우에는 SSH 터널링을 이용해서 해당 Pod나 Service에 접근해서 테스트를 한다


## Skaffold
- 코드 수정이 Kubernetes에 반영되기까지의 과정을 자동화하여 제공해주는 프레임워크
















