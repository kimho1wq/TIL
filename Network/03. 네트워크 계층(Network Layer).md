## 네트워크 계층(Network Layer)

### 1. 네트워크 계층 개요
- 라우터(router)
  - 포워딩(forwarding): 패킷이 라우터의 입력 링크에 도달했을 때 라우터는 그 패킷을 적절한 출력 링크로 이동시키는 것, 하드웨어에서 실행
  - 라우팅(routing): 송신자가 수신자에게 패킷을 전송할 때 패킷 경로를 결정하는 방법 또는 알고리즘, 소프트웨어에서 실행
  - 라우팅은 제어 영역(control plane)에서, 포워딩은 데이터 영역(data plane)에서 포워딩 테이블을 사이에 두고 상호 작용한다
  - 라우터는 포워딩 테이블에서 패킷의 목적지 주소의 프리픽스(prefix)를 테이블의 엔트리와 대응시켜서 그에 연관된 링크로 내보낸다
    - 최장 프리픽스 대응 규칙(longest prefix matching rule)을 적용한다
    - IP 주소의 앞에서 부터 가장 긴 대응 엔트리를 테이블에서 찾고, 그에 연관된 링크 인터페이스로 패킷을 보낸다
- IPv4 데이터그램 형식
  - 
  - 버전 번호: IPv4: 0100, IPv6: 0110
  - 헤더 길이: IPv4 데이터그램 헤더는 보통 20바이트 이다
  - TTL(Time-to-live)
    - 네트워크에서 데이터그램이 무한히 순환하지 않도록 한다(라우팅 루프)
    - 라우터가 데이터그램을 처리할 때마다(hop을 이동할 때마다) 감소하고, TTL 필드가 0이 되면 라우터가 데이터그램을 폐기한다
  - 프로토콜: 데이터그램이 최종 목적지에 도착했을 때 사용되며 전송 계층의 프로토콜을 명시한다(TCP: 17 or UDP: 6)
  - 헤더 체크섬
    - 데이터그램의 IP 헤더만 체크섬을 수행하고, TCP/UDP는 전체 세그먼트에 대해 체크섬을 수행한다
    - 데이터그램의 비트 오류를 탐지하는데 도움을 주고 라우터는 보통 오류가 검출된 데이터그램을 폐기한다
    - TTL 필드와 옵션 필드의 값은 계속 변경되므로 각 라우터에서 재계산되고 저장되어야 한다
  - 데이터(payload): 전송 계층 세그먼트(TCP or UDP)를 포함하지만 ICMP 메시지와 같은 다른 유형의 데이터를 담기도 한다
- IPv4 데이터그램 단편화(fragmentation)